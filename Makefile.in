STDIOWRAP_DIR = src/stdiowrap5
MCW_DIR       = src/mcw5
NCBI_DIR      = src/ncbi_c--May_15_2009_5
HMMER_DIR     = src/hmmer-3.0
DEMOS_DIR     = demos
TOOLS_DIR     = tools
TARGET_DIR    = %PREFIX%

.PHONY: stdiowrap mcw ncbi tools

all: stdiowrap mcw ncbi tools

stdiowrap:
	$(MAKE) -C $(STDIOWRAP_DIR)

mcw:
	$(MAKE) -C $(MCW_DIR)

ncbi: stdiowrap
	if test -d $(NCBI_DIR); then $(MAKE) -C $(NCBI_DIR); fi

hmmer: stdiowrap
	if test -d $(HMMER_DIR); then $(MAKE) -C $(HMMER_DIR); fi

tools:
	if test -d $(TOOLS_DIR); then $(MAKE) -C $(TOOLS_DIR); fi

clean:
	$(MAKE) -C $(STDIOWRAP_DIR) clean
	if test -d $(MCW_DIR); then $(MAKE) -C $(MCW_DIR) clean; fi
	if test -d $(NCBI_DIR); then $(MAKE) -C $(NCBI_DIR) clean; fi
	if test -d $(HMMER_DIR); then $(MAKE) -C $(HMMER_DIR) clean; fi
	rm -rf target

install: install-mcw install-ncbi install-tools

install-mcw: mcw
	# Binaries
	mkdir -p $(TARGET_DIR)/bin
	mkdir -p $(TARGET_DIR)/share/doc
	mkdir -p $(TARGET_DIR)/share/man/man1
	cp -f $(MCW_DIR)/mcw            \
	      $(MCW_DIR)/sortfasta      \
	      $(MCW_DIR)/SHMclean       \
	      $(MCW_DIR)/zextract       \
	      $(MCW_DIR)/wrap           \
	      $(MCW_DIR)/xmlparse       \
	      $(MCW_DIR)/fastalens      \
	      $(MCW_DIR)/fastadist      \
	      $(MCW_DIR)/compressmol2   \
	      $(MCW_DIR)/splitmol2      \
	      $(MCW_DIR)/splitfasta     \
	      $(MCW_DIR)/gather         \
	      $(MCW_DIR)/compressfasta  \
	      $(MCW_DIR)/compressfasta0 \
	      $(TARGET_DIR)/bin
	# Manpages
	cp -f doc/man/* $(TARGET_DIR)/share/man/man1
	gzip $(TARGET_DIR)/share/man/man1/*.1
	# Demos
	cp -rf $(DEMOS_DIR)/* $(TARGET_DIR)/share/doc
	# Other docs
	cp -f doc/mcw-blast.txt doc/README $(TARGET_DIR)/share/doc
	ln -s share/doc/README $(TARGET_DIR)/README

install-ncbi: ncbi
	mkdir -p $(TARGET_DIR)/lib/mcw
	cp -f $(NCBI_DIR)/ncbi/build/blastall $(TARGET_DIR)/lib/mcw

install-hmmer: hmmer
	mkdir -p $(TARGET_DIR)/lib/mcw
	#TODO: cp -f $(HMMER_DIR)/... $(TARGET_DIR)/lib/mcw

install-tools: tools
	mkdir -p $(TARGET_DIR)/opt/ncbi/bin
	cp -f $(TOOLS_DIR)/ncbi/build/asn2ff      \
	      $(TOOLS_DIR)/ncbi/build/asn2gb      \
	      $(TOOLS_DIR)/ncbi/build/asn2idx     \
	      $(TOOLS_DIR)/ncbi/build/asn2xml     \
	      $(TOOLS_DIR)/ncbi/build/asndhuff    \
	      $(TOOLS_DIR)/ncbi/build/asntool     \
	      $(TOOLS_DIR)/ncbi/build/bl2seq      \
	      $(TOOLS_DIR)/ncbi/build/blastall    \
	      $(TOOLS_DIR)/ncbi/build/blastcl3    \
	      $(TOOLS_DIR)/ncbi/build/blastclust  \
	      $(TOOLS_DIR)/ncbi/build/blastpgp    \
	      $(TOOLS_DIR)/ncbi/build/cdscan      \
	      $(TOOLS_DIR)/ncbi/build/checksub    \
	      $(TOOLS_DIR)/ncbi/build/copymat     \
	      $(TOOLS_DIR)/ncbi/build/debruijn    \
	      $(TOOLS_DIR)/ncbi/build/errhdr      \
	      $(TOOLS_DIR)/ncbi/build/fa2htgs     \
	      $(TOOLS_DIR)/ncbi/build/fastacmd    \
	      $(TOOLS_DIR)/ncbi/build/findspl     \
	      $(TOOLS_DIR)/ncbi/build/formatdb    \
	      $(TOOLS_DIR)/ncbi/build/formatrpsdb \
	      $(TOOLS_DIR)/ncbi/build/gene2xml    \
	      $(TOOLS_DIR)/ncbi/build/getpub      \
	      $(TOOLS_DIR)/ncbi/build/gil2bin     \
	      $(TOOLS_DIR)/ncbi/build/idfetch     \
	      $(TOOLS_DIR)/ncbi/build/impala      \
	      $(TOOLS_DIR)/ncbi/build/indexpub    \
	      $(TOOLS_DIR)/ncbi/build/makemat     \
	      $(TOOLS_DIR)/ncbi/build/makeset     \
	      $(TOOLS_DIR)/ncbi/build/megablast   \
	      $(TOOLS_DIR)/ncbi/build/rpsblast    \
	      $(TOOLS_DIR)/ncbi/build/seedtop     \
	      $(TOOLS_DIR)/ncbi/build/sortbyquote \
	      $(TOOLS_DIR)/ncbi/build/subfuse     \
	      $(TOOLS_DIR)/ncbi/build/taxblast    \
	      $(TOOLS_DIR)/ncbi/build/tbl2asn     \
	      $(TOOLS_DIR)/ncbi/build/vecscreen   \
	      $(TARGET_DIR)/opt/ncbi/bin
	mkdir -p $(TARGET_DIR)/opt/ncbi/man/man1
	cp -f $(TOOLS_DIR)/ncbi/doc/man/asn2ff.1      \
	      $(TOOLS_DIR)/ncbi/doc/man/asn2gb.1      \
	      $(TOOLS_DIR)/ncbi/doc/man/asn2idx.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/asn2xml.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/asndhuff.1    \
	      $(TOOLS_DIR)/ncbi/doc/man/asntool.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/bl2seq.1      \
	      $(TOOLS_DIR)/ncbi/doc/man/blast.1       \
	      $(TOOLS_DIR)/ncbi/doc/man/blastall.1    \
	      $(TOOLS_DIR)/ncbi/doc/man/blastcl3.1    \
	      $(TOOLS_DIR)/ncbi/doc/man/blastclust.1  \
	      $(TOOLS_DIR)/ncbi/doc/man/blastpgp.1    \
	      $(TOOLS_DIR)/ncbi/doc/man/cdscan.1      \
	      $(TOOLS_DIR)/ncbi/doc/man/checksub.1    \
	      $(TOOLS_DIR)/ncbi/doc/man/copymat.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/debruijn.1    \
	      $(TOOLS_DIR)/ncbi/doc/man/errhdr.1      \
	      $(TOOLS_DIR)/ncbi/doc/man/fa2htgs.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/fastacmd.1    \
	      $(TOOLS_DIR)/ncbi/doc/man/findspl.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/formatdb.1    \
	      $(TOOLS_DIR)/ncbi/doc/man/formatrpsdb.1 \
	      $(TOOLS_DIR)/ncbi/doc/man/gene2xml.1    \
	      $(TOOLS_DIR)/ncbi/doc/man/getpub.1      \
	      $(TOOLS_DIR)/ncbi/doc/man/gil2bin.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/idfetch.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/impala.1      \
	      $(TOOLS_DIR)/ncbi/doc/man/indexpub.1    \
	      $(TOOLS_DIR)/ncbi/doc/man/makemat.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/makeset.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/megablast.1   \
	      $(TOOLS_DIR)/ncbi/doc/man/rpsblast.1    \
	      $(TOOLS_DIR)/ncbi/doc/man/seedtop.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/sortbyquote.1 \
	      $(TOOLS_DIR)/ncbi/doc/man/subfuse.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/taxblast.1    \
	      $(TOOLS_DIR)/ncbi/doc/man/tbl2asn.1     \
	      $(TOOLS_DIR)/ncbi/doc/man/vecscreen.1   \
	      $(TARGET_DIR)/opt/ncbi/man/man1
	gzip $(TARGET_DIR)/opt/ncbi/man/man1/*.1

