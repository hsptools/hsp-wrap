package:
  name: binutils
  version: 2.23.1
  www: http://www.gnu.org/software/binutils/
  short: |
      The GNU Binutils are a collection of binary tools:
      ld (GNU linker)
      as (GNU assembler).


lfs:
  - http://www.linuxfromscratch.org/lfs/view/development/chapter05/binutils-pass1.html
  - http://www.linuxfromscratch.org/lfs/view/development/chapter05/binutils-pass2.html
  - http://www.linuxfromscratch.org/lfs/view/development/chapter06/binutils.html

download:
  gnu: ~
  checksum: 2ab2e5b03e086d12c6295f831adad46b3e1410a3a234933a2e8fac66cb2e7a19

version: 
  installed_sh_trailing: ld -V

# ============================================================

bootstrap_1:

  - echo: "configure"
  - sh: >
      ../${KX_BINUTILS}/configure
        --prefix="${KX_TOOLS}"
        --with-sysroot="${KX_MNT}"
        --with-lib-path="${KX_TOOLS}/lib"
        --target="${KX_TARGET}"
        --disable-nls
        --disable-werror

  - make: ~

  - sh: |
      case $(uname -m) in
        x86_64) mkdir -v "${KX_TOOLS}/lib" && ln -sv lib "${KX_TOOLS}/lib64" ;;
      esac

  - install: ~

# ============================================================

bootstrap_2:

  - separate_builddir: ~

  - echo: "configure"
  - sh: >
      CC="${KX_TARGET}-gcc"
      AR="${KX_TARGET}-ar"
      RANLIB="${KX_TARGET}-ranlib"
      ../${KX_BINUTILS}/configure
         --prefix=${KX_TOOLS}
         --disable-nls
         --with-lib-path=${KX_TOOLS}/lib

  - make: ~

  - sh: |
      case $(uname -m) in
        x86_64) mkdir -v "${KX_TOOLS}/lib" && ln -sv lib "${KX_TOOLS}/lib64" ;;
      esac

  - install: ~

  - echo: "post-install"
  - sh: |
      make -C ld clean
      make -C ld LIB_PATH=/lib
      cp -v ld/ld-new ${KX_TOOLS}/bin

# ============================================================

bootstrap_5:

  - todo: Check PTY's

  - echo: "patching"

  - sh: |
      # Suppress the installation of an outdated standards.info file as a newer one is installed later on in the Autoconf instructions: 
      rm -fv etc/standards.info
      sed -i.bak '/^INFO/s/standards.info //' etc/Makefile.in

  - separate_builddir: ~

  - echo: configure
  - sh: ../${KX_BINUTILS}/configure --prefix='' --enable-shared

  - make: tooldir=/

  - make: tooldir=/ -C libiberty clean
  - make: tooldir=/ CFLAGS="-fPIC" -C libiberty

  - make: tooldir=/ -C bfd clean
  - make: tooldir=/ CFLAGS="-fPIC" -C bfd

  - make: tooldir=/ -C opcodes clean
  - make: tooldir=/ CFLAGS="-fPIC" -C opcodes

  - check: -k

  - install: tooldir=/

  - echo: post-install
  - sh: |
      #Install the libiberty header file that is needed by some packages: 
      cp -v ../${KX_BINUTILS}/include/libiberty.h /include

